<!DOCTYPE html>
<html>
<head>
  <title>Test Session History API</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      max-width: 600px;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
    }
    button {
      background: #4CAF50;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background: #45a049;
    }
    #result {
      margin-top: 20px;
      padding: 15px;
      background: #f9f9f9;
      border-left: 4px solid #4CAF50;
      white-space: pre-wrap;
      font-family: monospace;
    }
    .session {
      padding: 10px;
      margin: 10px 0;
      background: #e8f5e9;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Test Session History</h1>
    <p>Testing the <code>/sessions/:botId/:userId</code> endpoint</p>

    <div>
      <label>Bot ID: <input id="botId" value="mattyatlas" /></label><br/><br/>
      <label>User ID: <input id="userId" value="999888777" type="number" /></label><br/><br/>
      <button onclick="fetchSessions()">Fetch Sessions</button>
    </div>

    <div id="result"></div>
  </div>

  <script>
    async function fetchSessions() {
      const botId = document.getElementById('botId').value;
      const userId = document.getElementById('userId').value;
      const resultDiv = document.getElementById('result');

      resultDiv.innerHTML = '<p>Loading...</p>';

      try {
        const response = await fetch(`http://localhost:3010/sessions/${botId}/${userId}`);
        const data = await response.json();

        if (data.currentSession) {
          let html = '<h3>Current Session:</h3>';
          html += '<div class="session">';
          html += `<strong>UUID:</strong> ${data.currentSession.uuid}<br/>`;
          html += `<strong>Message Count:</strong> ${data.currentSession.messageCount}<br/>`;
          html += `<strong>Created:</strong> ${new Date(data.currentSession.createdAt).toLocaleString()}<br/>`;
          html += `<strong>Updated:</strong> ${new Date(data.currentSession.updatedAt).toLocaleString()}`;
          html += '</div>';

          if (data.history && data.history.length > 0) {
            html += '<h3>History (' + data.history.length + ' sessions):</h3>';
            data.history.forEach(session => {
              html += '<div class="session">';
              html += `<strong>UUID:</strong> ${session.uuid}<br/>`;
              html += `<strong>Message Count:</strong> ${session.messageCount}<br/>`;
              html += `<strong>Ended:</strong> ${new Date(session.endedAt).toLocaleString()}`;
              html += '</div>';
            });
          } else {
            html += '<p><em>No session history yet</em></p>';
          }

          html += '<h3>Total Sessions: ' + data.totalSessions + '</h3>';
          resultDiv.innerHTML = html;
        } else {
          resultDiv.innerHTML = '<p style="color: orange;">No sessions found for this bot+user combination</p>';
        }
      } catch (error) {
        resultDiv.innerHTML = '<p style="color: red;">Error: ' + error.message + '</p>';
      }
    }

    // Auto-load on page load
    fetchSessions();
  </script>
</body>
</html>
