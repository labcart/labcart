# Claude Bot Platform - Desktop Environment with VNC
# Full Ubuntu desktop so you can visually install Claude Code IDE and MCP tools

FROM ubuntu:22.04

# Prevent interactive prompts
ENV DEBIAN_FRONTEND=noninteractive

# Install desktop environment and VNC server
RUN apt-get update && apt-get install -y \
    # Desktop environment (XFCE - lightweight)
    xfce4 \
    xfce4-goodies \
    # VNC server
    tigervnc-standalone-server \
    tigervnc-common \
    # Basic utilities
    curl \
    wget \
    gnupg \
    ca-certificates \
    # Node.js dependencies
    build-essential \
    python3 \
    # Browser (for downloading Claude)
    firefox \
    # Text editor
    nano \
    vim \
    && rm -rf /var/lib/apt/lists/*

# Install Node.js
RUN curl -fsSL https://deb.nodesource.com/setup_20.x | bash - \
    && apt-get install -y nodejs

# Create VNC user directory
RUN mkdir -p /root/.vnc

# Set VNC password (change this!)
RUN echo "password" | vncpasswd -f > /root/.vnc/passwd \
    && chmod 600 /root/.vnc/passwd

# Create xstartup file for VNC
RUN echo '#!/bin/bash\n\
xrdb $HOME/.Xresources\n\
startxfce4 &' > /root/.vnc/xstartup \
    && chmod +x /root/.vnc/xstartup

# Create app directory
WORKDIR /app

# Copy bot manager code
COPY package*.json ./
RUN npm install
COPY . .

# Expose VNC port
EXPOSE 5901

# Expose bot manager port (if needed)
EXPOSE 3000

# Start VNC server
CMD ["sh", "-c", "vncserver :1 -geometry 1920x1080 -depth 24 -localhost no && tail -f /root/.vnc/*.log"]
